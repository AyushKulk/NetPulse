ğŸ“Š FIRESTORE DATABASE STRUCTURE
================================

Your Firestore Database
â”‚
â”œâ”€â”€ ğŸ“ network_metrics (collection)          â† Change in FirestoreService.swift line 18, 28
â”‚   â””â”€â”€ ğŸ“„ {auto-generated-id}
â”‚       â”œâ”€â”€ timestamp: Timestamp
â”‚       â”œâ”€â”€ latency: Number
â”‚       â”œâ”€â”€ throughput_down: Number         â† Field name in NetworkMetrics.swift CodingKeys
â”‚       â”œâ”€â”€ throughput_up: Number
â”‚       â”œâ”€â”€ packet_loss: Number
â”‚       â”œâ”€â”€ signal_strength: Number
â”‚       â”œâ”€â”€ jitter: Number
â”‚       â””â”€â”€ device_id: String               â† Used in query .whereField("device_id", ...)
â”‚
â”œâ”€â”€ ğŸ“ sensor_data (collection)              â† Change in FirestoreService.swift line 43, 60
â”‚   â””â”€â”€ ğŸ“„ {auto-generated-id}
â”‚       â”œâ”€â”€ timestamp: Timestamp
â”‚       â”œâ”€â”€ sensor_type: String             â† "temperature", "humidity", "motion", etc.
â”‚       â”œâ”€â”€ value: Number
â”‚       â”œâ”€â”€ unit: String
â”‚       â”œâ”€â”€ device_id: String
â”‚       â””â”€â”€ arduino_id: String
â”‚
â”œâ”€â”€ ğŸ“ anomalies (collection)                â† Change in FirestoreService.swift line 76, 91, 104
â”‚   â””â”€â”€ ğŸ“„ {auto-generated-id}
â”‚       â”œâ”€â”€ timestamp: Timestamp
â”‚       â”œâ”€â”€ type: String                    â† "latency_spike", "packet_loss", etc.
â”‚       â”œâ”€â”€ severity: String                â† "critical", "warning", "info"
â”‚       â”œâ”€â”€ description: String
â”‚       â”œâ”€â”€ root_cause: String
â”‚       â”œâ”€â”€ recommended_action: String
â”‚       â”œâ”€â”€ is_resolved: Boolean
â”‚       â”œâ”€â”€ resolved_at: Timestamp
â”‚       â”œâ”€â”€ affected_metrics: Array<String>
â”‚       â””â”€â”€ device_id: String
â”‚
â”œâ”€â”€ ğŸ“ agent_actions (collection)            â† Change in FirestoreService.swift line 110, 118
â”‚   â””â”€â”€ ğŸ“„ {auto-generated-id}
â”‚       â”œâ”€â”€ timestamp: Timestamp
â”‚       â”œâ”€â”€ action_type: String
â”‚       â”œâ”€â”€ description: String
â”‚       â”œâ”€â”€ success: Boolean
â”‚       â”œâ”€â”€ anomaly_id: String
â”‚       â”œâ”€â”€ before_metrics: Map
â”‚       â”œâ”€â”€ after_metrics: Map
â”‚       â””â”€â”€ ai_response: String
â”‚
â””â”€â”€ ğŸ“ agent_state (collection)              â† Change in FirestoreService.swift line 123
    â””â”€â”€ ğŸ“„ current (document)                â† Change document name here too
        â”œâ”€â”€ status: String                   â† "idle", "analyzing", "acting", "waiting"
        â”œâ”€â”€ current_task: String
        â”œâ”€â”€ last_action_timestamp: Timestamp
        â”œâ”€â”€ model_version: String
        â””â”€â”€ accuracy_score: Number


ğŸ”„ DATA FLOW DIAGRAM
====================

Raspberry Pi                 Firestore Cloud              iOS App
    â”‚                             â”‚                         â”‚
    â”œâ”€ Network Tools              â”‚                         â”‚
    â”‚  (ping, speedtest)          â”‚                         â”‚
    â”‚        â”‚                    â”‚                         â”‚
    â”‚        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>  â”‚  network_metrics        â”‚
    â”‚                              â”‚         â”‚               â”‚
    â”‚                              â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ DashboardView
    â”‚                              â”‚                         â”‚ NetworkMonitorView
    â”œâ”€ Arduino Sensors             â”‚                         â”‚
    â”‚  (DHT11, MPU6050)            â”‚                         â”‚
    â”‚        â”‚                     â”‚                         â”‚
    â”‚        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>   â”‚  sensor_data            â”‚
    â”‚                              â”‚         â”‚               â”‚
    â”‚                              â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ SensorsDashboardView
    â”‚                              â”‚                         â”‚
    â”œâ”€ ML Models                   â”‚                         â”‚
    â”‚  (Isolation Forest)          â”‚                         â”‚
    â”‚        â”‚                     â”‚                         â”‚
    â”‚        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>   â”‚  anomalies              â”‚
    â”‚                              â”‚         â”‚               â”‚
    â”‚                              â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ AnomaliesView
    â”‚                              â”‚                         â”‚ DashboardView (alerts)
    â”‚                              â”‚                         â”‚
    â”‚                              â”‚                         â”‚
    â”‚                              â”‚  <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ User requests AI analysis
    â”‚                              â”‚                         â”‚
    â”‚                              â”‚                         â”œâ”€> Gemini API
    â”‚                              â”‚                         â”‚       â”‚
    â”‚                              â”‚  agent_actions <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                              â”‚         â”‚
    â”‚                              â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ AIAgentView
    â”‚                              â”‚                         â”‚


ğŸ“ QUERY PATTERNS USED
======================

1. Fetch with filtering:
   db.collection("network_metrics")
     .whereField("device_id", isEqualTo: "raspberry_pi_001")
     .order(by: "timestamp", descending: true)
     .limit(to: 100)

2. Real-time listener:
   db.collection("sensor_data")
     .whereField("device_id", isEqualTo: deviceId)
     .addSnapshotListener { ... }

3. Compound query:
   db.collection("sensor_data")
     .whereField("device_id", isEqualTo: deviceId)
     .whereField("sensor_type", isEqualTo: "temperature")

4. Document update:
   db.collection("anomalies")
     .document(anomalyId)
     .updateData([...])

5. Add new document:
   db.collection("agent_actions")
     .addDocument(from: action)


ğŸ¯ WHERE TO CHANGE WHAT
=======================

To change collection "network_metrics" to "metrics":
â”œâ”€ FirestoreService.swift:18  â†’ db.collection("metrics")
â””â”€ FirestoreService.swift:28  â†’ db.collection("metrics")

To change field "device_id" to "raspberry_pi_id":
â”œâ”€ NetworkMetrics.swift       â†’ case deviceId = "raspberry_pi_id"
â”œâ”€ SensorData.swift           â†’ case deviceId = "raspberry_pi_id"
â”œâ”€ Anomaly.swift              â†’ case deviceId = "raspberry_pi_id"
â””â”€ FirestoreService.swift     â†’ .whereField("raspberry_pi_id", ...)
   (All .whereField references to device_id)

To change default device ID from "raspberry_pi_001":
â”œâ”€ DashboardViewModel.swift:18     â†’ private let deviceId = "your_id"
â”œâ”€ NetworkMonitorViewModel.swift:11 â†’ private let deviceId = "your_id"
â””â”€ SettingsView.swift:11           â†’ @AppStorage("deviceId") = "your_id"


ğŸ“š EXAMPLE FIRESTORE DOCUMENTS
===============================

network_metrics/abc123:
{
  "timestamp": Timestamp(2025, 10, 18, 10, 30, 0),
  "latency": 45.2,
  "throughput_down": 120.5,
  "throughput_up": 25.3,
  "packet_loss": 0.5,
  "signal_strength": -65,
  "jitter": 8.2,
  "device_id": "raspberry_pi_001"
}

sensor_data/xyz789:
{
  "timestamp": Timestamp(2025, 10, 18, 10, 30, 0),
  "sensor_type": "temperature",
  "value": 25.5,
  "unit": "Â°C",
  "device_id": "raspberry_pi_001",
  "arduino_id": "arduino_001"
}

anomalies/def456:
{
  "timestamp": Timestamp(2025, 10, 18, 10, 30, 0),
  "type": "latency_spike",
  "severity": "warning",
  "description": "Latency increased to 150ms",
  "root_cause": "Network congestion detected",
  "recommended_action": "Consider restarting router",
  "is_resolved": false,
  "affected_metrics": ["latency", "jitter"],
  "device_id": "raspberry_pi_001"
}

agent_state/current:
{
  "status": "idle",
  "current_task": null,
  "last_action_timestamp": Timestamp(2025, 10, 18, 10, 0, 0),
  "model_version": "1.0.0",
  "accuracy_score": 92.5
}
